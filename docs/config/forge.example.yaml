# forge.example.yaml
version: 1

repo:
  packages_dir: "packages"
  docs_dir: "docs"

git:
  mode: "worktree"         # worktree | branch | commit
  branch_prefix: "forge/"
  commit_strategy: "final" # final | per-iteration

llm:
  provider: "openai"       # openai | anthropic | ...
  model: "gpt-5"
  temperature: 0.2
  max_tokens: 8000

policies:
  docs_as_contract: true
  require_package_readme: true

  # Never send these to the model:
  forbid_paths:
    - ".env"
    - ".env.*"
    - "**/secrets/**"
    - "**/*.pem"
    - "**/*.key"

  # Safety redactions for accidental inclusion in logs/snippets:
  redact_patterns:
    - "(?i)aws_access_key_id\s*=\s*.+"
    - "(?i)aws_secret_access_key\s*=\s*.+"
    - "(?i)api_key\s*=\s*.+"
    - "(?i)token\s*=\s*.+"

  env_sync:
    prod_env_file: ".env.prod"
    sync_command: "pnpm sync:prod"
    require_sync_on_change: true

docs:
  render_command: "pnpm docs:render"
  check_command: "pnpm docs:check"
  diagrams_dir: "docs/assets/diagrams"
  inference:
    enabled: true
    max_docs: 7
    max_sections_per_doc: 6
    confidence_fail_in_ci: true

infra:
  provider: "auto"                    # auto | cdk | sst | serverless
  synth_command: "pnpm -C infra cdk:synth"

verification:
  commands:
    - "pnpm -r lint"
    - "pnpm -r typecheck"
    - "pnpm -r test"
  fail_fast: true

agent:
  max_iterations: 3
  require_plan_citations: true
  require_doc_update_on_behavior_change: true
